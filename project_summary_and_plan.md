# סיכום פרויקט ותוכנית עבודה מעודכנת: מערכת "הדוור הבא"

## 1. מבוא
מסמך זה מרכז את כל המידע שנאסף עד כה אודות פרויקט "הדוור הבא", מפרט את הדרישות, הארכיטקטורה המתוכננת, ומתאר את תוכנית העבודה המעודכנת לבניית המערכת. המטרה היא לספק תמונה מלאה ובהירה של הפרויקט.

## 2. רקע ודרישות הפרויקט

### 2.1. תיאור כללי
הפרויקט נועד לתת שירות משלוחים אישי לעובדים בחברות המקבלות שירותי דואר קבועים. השירות יכלול איסוף דברי דואר וחבילות ממוקדי מסירה שונים ומסירתם לעובדים במקום עבודתם, בימים קבועים. המערכת תכלול שלוש אפליקציות עיקריות: לקוח, ניהול ושליחים.

### 2.2. אפליקציית לקוח
*   **משתמשים:** לקוח ראשי (עובד בחברה) ומשתמשים משניים (בני משפחה). לקוח ראשי יכול לצרף ולנהל משתמשים משניים.
*   **רישום ואימות:** שם משתמש, טלפון, אימייל, סיסמה. אימות באמצעות מייל (למשתמש ראשי) ו-WhatsApp (לכל המשתמשים).
*   **השלמת פרטים:** שם חברה, כתובת חברה, קומה, הערות לשליח.
*   **העלאת חבילות לאיסוף (3 דרכים):**
    1.  **WhatsApp Bot:** שליחת הודעה לערוץ WhatsApp, חילוץ פרטים אוטומטי (שם לקוח, מספר מעקב, מקום איסוף, כתובת, שעות פעילות, תאריך אחרון, קישור) באמצעות AI.
    2.  **אפליקציה (קובץ/צילום מסך/טקסט):** העלאת קובץ טקסט או צילום מסך, או הזנת טקסט ידני. חילוץ פרטים אוטומטי בדומה ל-WhatsApp Bot.
    3.  **טופס ידני באפליקציה:** מילוי ידני של כל פרטי החבילה בטופס ייעודי.
*   **דשבורד לקוח:**
    *   **לקוח ראשי:** צפייה בכל החבילות שלו ושל בני משפחתו, פתיחת קריאת שירות, הוספה/מחיקה של משתמשים משניים, צפייה בסטטוס חבילות, ביצוע תשלומים (הוראת קבע), צפייה בסטטוס שירות (פעיל/לא פעיל), בדיקת סטטוס פריט לפי מספר מעקב (כולל מסלול פריט).
    *   **משתמש משני:** צפייה בחבילות שהעלה בעצמו בלבד, צפייה בסטטוס חבילות, בדיקת סטטוס פריט לפי מספר מעקב (כולל מסלול פריט).
*   **סטטוסי חבילות:** ממתינה לאיסוף, נאספה, בתהליך מסירה, נמסרה, בבירור.
*   **התראות אוטומטיות:** הודעות WhatsApp ללקוח בכל שינוי סטטוס (הוספת חבילה, איסוף, מסירה).

### 2.3. אפליקציית ניהול
*   **משתמשים:** מנהל ראשי ומנהלים נוספים עם הרשאות מוגדרות.
*   **דשבורד ניהול:**
    *   **מידע פסיבי:** מידע על משלוחים (לפי פילטרים שונים: סטטוס, תאריך, מיקום, חברת הפצה, עיר), מידע על לקוחות (לפי פילטרים: שיוך לחברה, פעילים/לא פעילים, טלפון, אימייל, שם), מידע על חברות (שם, כתובת, איש קשר, ימי חלוקה), סקירה כללית (מספר חברות, לקוחות פעילים, צפי הכנסות, שליחים, חבילות).
    *   **פעולות אקטיביות:** הוספת לקוח, הוספת חבילה לאיסוף (בכל אחת מ-3 הדרכים), שינוי סטטוס חבילה, צפייה בדוח עבודה יומי, שליחת קישור לתשלום חד פעמי, הוספה/מחיקה של שליח (כולל שליחת פרטי התחברות ל-WhatsApp), בדיקת סטטוס פריט.

### 2.4. אפליקציית שליחים
*   **התחברות:** באמצעות שם משתמש וסיסמה שקיבלו מאפליקציית הניהול.
*   **דשבורד שליח:**
    *   **משימות:** חבילות לאיסוף וחבילות למסירה, מוצגות בצורה מרוכזת וממוינות לפי מקום (כתובת/שם המקום), עם סיכום חבילות לכל מקום.
    *   **עדכון סטטוס:** אפשרות לעדכן סטטוס חבילה מכל שורת חבילה.
    *   **דוחות:** דוחות ביצועים על משימות שבוצעו.
    *   **תקשורת:** יצירת קשר טלפוני/WhatsApp עם הלקוח הראשי, שליחת WhatsApp למנהל לבירור.
    *   **תיעוד:** כתיבת הערות שליח, צילום והוכחת מסירה.
    *   **בדיקת סטטוס פריט:** לפי מספר מעקב (כולל מסלול פריט).

## 3. ארכיטקטורת מערכת (Firebase)

### 3.1. רכיבים עיקריים
| רכיב | תיאור | שירותי Firebase | פלטפורמה |
| :--- | :--- | :--- | :--- |
| **אפליקציית לקוח** | ממשק משתמש ללקוחות | `Authentication`, `Firestore`, `Storage`, `Cloud Functions` | Web (React) |
| **אפליקציית ניהול** | ממשק משתמש למנהלים | `Authentication`, `Firestore`, `Cloud Functions` | Web (React) |
| **אפליקציית שליחים** | ממשק משתמש לשליחים | `Authentication`, `Firestore`, `Storage`, `Cloud Functions` | Web (React) |
| **Backend** | לוגיקה עסקית, אוטומציות, אינטגרציות | `Cloud Functions`, `Firestore` | Node.js |

### 3.2. מודל נתונים (Firestore)
*   **`users`**: אוסף משתמשים (לקוחות, מנהלים, שליחים).
    *   `uid`: מזהה ייחודי (מ-Authentication).
    *   `email`, `phoneNumber`, `displayName`.
    *   `role`: תפקיד (`customer`, `admin`, `courier`).
    *   `companyId`: (ללקוחות) שיוך לחברה.
    *   `isPrimary`: (ללקוחות) האם משתמש ראשי.
    *   `familyId`: (ללקוחות) מזהה משפחה, לקישור בין משתמשים ראשיים למשניים.
    *   `primaryUserId`: (למשתמשים משניים) מזהה ה-`uid` של המשתמש הראשי שאליו הם משויכים.
*   **`packages`**: אוסף חבילות.
    *   `packageId`, `customerId`, `trackingNumber`.
    *   `pickupDetails`: אובייקט עם פרטי איסוף (שם מקום, כתובת, שעות פעילות).
    *   `status`: סטטוס החבילה.
    *   `createdAt`, `updatedAt`.
    *   `courierId`: (אופציונלי) מזהה השליח המטפל.
*   **`companies`**: אוסף חברות.
    *   `companyId`, `name`, `address`, `contactPerson`, `deliveryDays`.
*   **`payments`**: אוסף תשלומים.
    *   `paymentId`, `familyId`, `amount`, `status`, `date`.

### 3.3. טכנולוגיות וכלים
*   **פלטפורמה:** Firebase (Authentication, Firestore, Storage, Cloud Functions, Hosting).
*   **Frontend:** React.
*   **Backend (Cloud Functions):** Node.js.
*   **אינטגרציית WhatsApp:** Twilio API for WhatsApp.
*   **שליחת אימיילים:** SendGrid API.
*   **עיבוד תמונה וטקסט (OCR/NLP):** Google Cloud Vision AI / Gemini.
*   **ניהול תלויות:** pnpm.

## 4. תוכנית עבודה מעודכנת

להלן שלבי הפיתוח המפורטים, תוך התחשבות בידע הבסיסי שלך בתכנות ושיתוף הפעולה בינינו:

1.  **ניתוח דרישות מפורט ויצירת ארכיטקטורה ראשונית (הושלם)**
    *   איסוף דרישות מהמשתמש.
    *   יצירת מסמך ארכיטקטורה (`architecture_overview.md`).
    *   עדכון מסמך הארכיטקטורה עם שדה `primaryUserId` למשתמשים משניים.
    *   הכנת מסמך סיכום זה (`project_summary_and_plan.md`).

2.  **הגדרת פרויקט Firebase ואיפוס סביבת עבודה**
    *   יצירת פרויקט Firebase חדש בקונסולת Firebase.
    *   התקנת Firebase CLI ואיפוס סביבת הפיתוח המקומית.
    *   הגדרת כללי אבטחה בסיסיים ל-Firestore ו-Storage.

3.  **פיתוח מודל נתונים ב-Firestore**
    *   הגדרת אוספים ומסמכים ב-Firestore בהתאם למודל הנתונים שתוכנן.
    *   כתיבת כללי אבטחה מפורטים ל-Firestore כדי להבטיח גישה מאובטחת לנתונים עבור כל סוג משתמש.

4.  **הקמת מערכת אימות משתמשים (Authentication)**
    *   הגדרת שיטות אימות (אימייל/סיסמה, טלפון).
    *   מימוש תהליכי הרשמה, התחברות, איפוס סיסמה, ואימות אימייל/טלפון.
    *   ניהול תפקידי משתמשים (`roles`) באמצעות `Custom Claims` ב-Firebase Authentication.

5.  **פיתוח Cloud Functions ללוגיקה עסקית ואינטגרציות**
    *   פונקציות לטיפול בהרשמת משתמשים חדשים ועדכון פרטי פרופיל.
    *   פונקציות לחילוץ פרטי חבילה מהודעות WhatsApp/טקסט/תמונות (OCR/NLP).
    *   פונקציות לשליחת התראות WhatsApp/אימייל אוטומטיות על שינויי סטטוס חבילה.
    *   פונקציות לניהול תשלומים והוראות קבע.
    *   פונקציות לניהול שליחים (הוספה, מחיקה, הקצאת משימות).

6.  **פיתוח אפליקציית לקוחות (Web React)**
    *   בניית ממשק משתמש להרשמה והתחברות.
    *   פיתוח דשבורד לקוח ראשי ומשני.
    *   מימוש 3 דרכי העלאת חבילות לאיסוף.
    *   פיתוח מסך מעקב סטטוס חבילות.
    *   מימוש ניהול משתמשים משניים ותשלומים.

7.  **פיתוח אפליקציית ניהול (Web React)**
    *   בניית ממשק משתמש להתחברות מנהלים.
    *   פיתוח דשבורד ניהול עם פילטרים ודוחות.
    *   מימוש יכולות הוספה/עריכה/מחיקה של לקוחות, חברות, חבילות ושליחים.
    *   פיתוח מסך הקצאת משימות לשליחים.

8.  **פיתוח אפליקציית שליחים (Web React)**
    *   בניית ממשק משתמש להתחברות שליחים.
    *   פיתוח דשבורד שליח עם רשימת משימות (איסוף/מסירה) ממוינות.
    *   מימוש יכולות עדכון סטטוס חבילה, הוספת הערות, וצילום הוכחת מסירה.
    *   שילוב יכולות תקשורת (טלפון/WhatsApp) עם לקוחות ומנהלים.

9.  **הטמעה ואינטגרציה של כלל המרכיבים**
    *   חיבור כל האפליקציות ל-Firebase Backend.
    *   בדיקה מקצה לקצה של זרימות עבודה מורכבות.

10. **בדיקות ופריסה ראשונית (Hosting)**
    *   ביצוע בדיקות יחידה, אינטגרציה ומערכת.
    *   פריסה ראשונית של האפליקציות ל-Firebase Hosting, כאשר לכל אפליקציה כתובת URL נפרדת.

11. **הכנת תיעוד מפורט ומסירת הפרויקט**
    *   הכנת תיעוד טכני למפתחים.
    *   הכנת מדריך למשתמשים (לקוחות, מנהלים, שליחים).
    *   מסירת קוד המקור והנחיות לתחזוקה עתידית.

--- 
מסמך זה הוא סיכום מקיף של הפרויקט. נשתמש בו כמפת דרכים להמשך העבודה.
